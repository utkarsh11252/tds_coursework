unzip("data/lsoa.zip", exdir="data/")
lsoa_data = read_sf("data/england_lsoa_2021.shp")
ggsave("figures/eda1.png", plot = f1, width = 10, height = 6, dpi = 300)
summary(leeds_df)
summary(leeds_df)
print(summary(leeds_df))
summary(leeds_df)
ggsave("figures/eda1.png", plot = f1, width = 10, height = 6)
f1 = ggplot(plot_data, aes(x = factor(accident_year), y = count, fill = accident_severity)) +
geom_bar(stat = "identity", position = "dodge") +
geom_text(aes(label = count), position = position_dodge(width = 0.9), vjust = -0.5) +
geom_point(aes(y = total_accidents, color = "Total Accidents"), size = 3, shape = 21, fill = "white") +
geom_line(aes(x = as.numeric(factor(accident_year)), y = total_accidents, color = "Total Accidents", group = 1)) + # Adding a line to connect points
scale_color_manual(values = c("Total Accidents" = "red"), name = "") +
labs(x = "Accident Year",
y = "Count",
fill = "Accident Severity"
)
ggsave("figures/eda1.png", plot = f1, width = 10, height = 6)
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour)
crash_rel
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(day, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
summary(crashes_day_rel)
summary(crash_rel)
head(crash_rel)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~day, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
leeds_df$dow
order(leeds_df$dow)
unique(leeds_df$dow)
level(leeds_df$dow)
levels(leeds_df$dow)
leeds_final = leeds_ac_unq %>% mutate(casualty_type = case_when(casualty_type %in%
c(cas_type[1],
cas_type[2]) ~
"Car",
casualty_type %in% c(cas_type[4],
cas_type[7],
cas_type[8],
cas_type[9],
cas_type[13]) ~
"Motorcycle",
casualty_type %in% c(cas_type[3],
cas_type[12]) ~
"Bus",
casualty_type %in% c(cas_type[5],
cas_type[6],
cas_type[11]) ~
"Goods vehicle",
casualty_type %in% c(cas_type[10]) ~
"Others")) %>%
mutate(casualty_type = factor(casualty_type,
levels = c("Car",
"Motorcycle",
"Bus",
"Goods vehicle",
"Others"))) %>%
mutate(accident_severity = factor(accident_severity,
levels = c("Slight",
"Serious",
"Fatal"))) %>%
mutate(weather_conditions = factor(weather_conditions,
levels = c(weather[1],
weather[2],
weather[3],
weather[4],
weather[5],
weather[6],
weather[7],
weather[8],
weather[9]))) %>%
mutate(light_conditions = factor(light_conditions,
levels = c(light[1],
light[2],
light[3],
light[4],
light[5]))) %>%
mutate(road_type = factor(road_type,
levels = c(rd_type[1],
rd_type[2],
rd_type[3],
rd_type[4],
rd_type[5],
rd_type[6]))) %>%
mutate(date = ymd(date),
time = hms(time)) %>%
mutate(dow = factor(wday(date, label=TRUE)),
hour = hour(time)) %>%
select(-"date",
-"time",
-"local_authority_district")
write_csv(leeds_final,"data/leeds_final.csv")
leeds_df = read_csv("data/leeds_final.csv")
levels(leeds_df$dow)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
class(leeds_df$dow)
leeds_ac_comb = ac_comb %>% select("accident_reference",
"accident_year",
"location_easting_osgr",
"location_northing_osgr",
"accident_severity",
"number_of_casualties",
"date",
"time",
"local_authority_ons_district",
"road_type",
"speed_limit",
"light_conditions",
"weather_conditions",
"lsoa_of_accident_location") %>%
filter(lsoa_of_accident_location %in% leeds_lsoa$lsoa21cd)
leeds_ac = cas_comb %>% select("accident_reference",
"casualty_type") %>%
right_join(leeds_ac_comb, by=c("accident_reference" = "accident_reference")) %>%
filter(!casualty_type %in% c("Cyclist",
"Pedestrian",
"Horse rider",
"Tram occupant",
"Mobility scooter rider",
"Electric motorcycle rider or passenger",
NA,
"Agricultural vehicle occupant"))
leeds_ac_unq = leeds_ac %>%
distinct(accident_reference, .keep_all = TRUE)
leeds_final = leeds_ac_unq %>% mutate(casualty_type = case_when(casualty_type %in%
c(cas_type[1],
cas_type[2]) ~
"Car",
casualty_type %in% c(cas_type[4],
cas_type[7],
cas_type[8],
cas_type[9],
cas_type[13]) ~
"Motorcycle",
casualty_type %in% c(cas_type[3],
cas_type[12]) ~
"Bus",
casualty_type %in% c(cas_type[5],
cas_type[6],
cas_type[11]) ~
"Goods vehicle",
casualty_type %in% c(cas_type[10]) ~
"Others")) %>%
mutate(casualty_type = factor(casualty_type,
levels = c("Car",
"Motorcycle",
"Bus",
"Goods vehicle",
"Others"))) %>%
mutate(accident_severity = factor(accident_severity,
levels = c("Slight",
"Serious",
"Fatal"))) %>%
mutate(weather_conditions = factor(weather_conditions,
levels = c(weather[1],
weather[2],
weather[3],
weather[4],
weather[5],
weather[6],
weather[7],
weather[8],
weather[9]))) %>%
mutate(light_conditions = factor(light_conditions,
levels = c(light[1],
light[2],
light[3],
light[4],
light[5]))) %>%
mutate(road_type = factor(road_type,
levels = c(rd_type[1],
rd_type[2],
rd_type[3],
rd_type[4],
rd_type[5],
rd_type[6]))) %>%
mutate(date = ymd(date),
time = hms(time)) %>%
mutate(dow = factor(wday(date, label=TRUE)),
hour = hour(time)) %>%
select(-"date",
-"time",
-"local_authority_district")
leeds_final = leeds_ac_unq %>% mutate(casualty_type = case_when(casualty_type %in%
c(cas_type[1],
cas_type[2]) ~
"Car",
casualty_type %in% c(cas_type[4],
cas_type[7],
cas_type[8],
cas_type[9],
cas_type[13]) ~
"Motorcycle",
casualty_type %in% c(cas_type[3],
cas_type[12]) ~
"Bus",
casualty_type %in% c(cas_type[5],
cas_type[6],
cas_type[11]) ~
"Goods vehicle",
casualty_type %in% c(cas_type[10]) ~
"Others")) %>%
mutate(casualty_type = factor(casualty_type,
levels = c("Car",
"Motorcycle",
"Bus",
"Goods vehicle",
"Others"))) %>%
mutate(accident_severity = factor(accident_severity,
levels = c("Slight",
"Serious",
"Fatal"))) %>%
mutate(weather_conditions = factor(weather_conditions,
levels = c(weather[1],
weather[2],
weather[3],
weather[4],
weather[5],
weather[6],
weather[7],
weather[8],
weather[9]))) %>%
mutate(light_conditions = factor(light_conditions,
levels = c(light[1],
light[2],
light[3],
light[4],
light[5]))) %>%
mutate(road_type = factor(road_type,
levels = c(rd_type[1],
rd_type[2],
rd_type[3],
rd_type[4],
rd_type[5],
rd_type[6]))) %>%
mutate(date = ymd(date),
time = hms(time)) %>%
mutate(dow = factor(wday(date, label=TRUE)),
hour = hour(time)) %>%
select(-"date",
-"time",
-"local_authority_ons_district")
write_csv(leeds_final,"data/leeds_final.csv")
leeds_df = read_csv("data/leeds_final.csv")
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
class(leeds_df$dow)
leeds_final = leeds_ac_unq %>% mutate(casualty_type = case_when(casualty_type %in%
c(cas_type[1],
cas_type[2]) ~
"Car",
casualty_type %in% c(cas_type[4],
cas_type[7],
cas_type[8],
cas_type[9],
cas_type[13]) ~
"Motorcycle",
casualty_type %in% c(cas_type[3],
cas_type[12]) ~
"Bus",
casualty_type %in% c(cas_type[5],
cas_type[6],
cas_type[11]) ~
"Goods vehicle",
casualty_type %in% c(cas_type[10]) ~
"Others")) %>%
mutate(casualty_type = factor(casualty_type,
levels = c("Car",
"Motorcycle",
"Bus",
"Goods vehicle",
"Others"))) %>%
mutate(accident_severity = factor(accident_severity,
levels = c("Slight",
"Serious",
"Fatal"))) %>%
mutate(weather_conditions = factor(weather_conditions,
levels = c(weather[1],
weather[2],
weather[3],
weather[4],
weather[5],
weather[6],
weather[7],
weather[8],
weather[9]))) %>%
mutate(light_conditions = factor(light_conditions,
levels = c(light[1],
light[2],
light[3],
light[4],
light[5]))) %>%
mutate(road_type = factor(road_type,
levels = c(rd_type[1],
rd_type[2],
rd_type[3],
rd_type[4],
rd_type[5],
rd_type[6]))) %>%
mutate(date = ymd(date),
time = hms(time)) %>%
mutate(dow = wday(date, label=TRUE),
hour = hour(time)) %>%
select(-"date",
-"time",
-"local_authority_ons_district")
class(leeds_final$dow)
write_csv(leeds_final,"data/leeds_final.csv")
leeds_df = read_csv("data/leeds_final.csv")
leeds_df$dow = factor(leeds_df$dow)
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
crash_rel = leeds_final %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
head(crash_rel)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
leeds_final = leeds_ac_unq %>% mutate(casualty_type = case_when(casualty_type %in%
c(cas_type[1],
cas_type[2]) ~
"Car",
casualty_type %in% c(cas_type[4],
cas_type[7],
cas_type[8],
cas_type[9],
cas_type[13]) ~
"Motorcycle",
casualty_type %in% c(cas_type[3],
cas_type[12]) ~
"Bus",
casualty_type %in% c(cas_type[5],
cas_type[6],
cas_type[11]) ~
"Goods vehicle",
casualty_type %in% c(cas_type[10]) ~
"Others")) %>%
mutate(casualty_type = factor(casualty_type,
levels = c("Car",
"Motorcycle",
"Bus",
"Goods vehicle",
"Others"))) %>%
mutate(accident_severity = factor(accident_severity,
levels = c("Slight",
"Serious",
"Fatal"))) %>%
mutate(weather_conditions = factor(weather_conditions,
levels = c(weather[1],
weather[2],
weather[3],
weather[4],
weather[5],
weather[6],
weather[7],
weather[8],
weather[9]))) %>%
mutate(light_conditions = factor(light_conditions,
levels = c(light[1],
light[2],
light[3],
light[4],
light[5]))) %>%
mutate(road_type = factor(road_type,
levels = c(rd_type[1],
rd_type[2],
rd_type[3],
rd_type[4],
rd_type[5],
rd_type[6]))) %>%
mutate(date = ymd(date),
time = hms(time)) %>%
mutate(dow = wday(date, label=TRUE),
hour = hour(time)) %>%
select(-"date",
-"time",
-"local_authority_ons_district")
write_csv(leeds_final,"data/leeds_final.csv")
leeds_df = read_csv("data/leeds_final.csv")
crash_rel = leeds_final %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
crash_rel = leeds_df %>%
select(dow, hour) %>%
group_by(hour) %>%
mutate(n_per_hour = n()/7) %>%
group_by(dow, hour) %>%
summarise(n_hday = n(), n_h = first(n_per_hour)) %>%
mutate(hday_relative = n_hday / n_h)
crash_rel$dow = factor(crash_rel$dow, levels=c("Mon","Tue","Wed","Thu","Fri","Sat","Sun"))
crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
f2 = crash_rel %>%
ggplot(aes(x = hour, y = hday_relative)) +
geom_col(fill = "skyblue", color = "black") +  # Adjust fill and outline color
facet_wrap(~dow, nrow = 1) +
labs(x = "Hour of Day",
y = "Relative Crashes",
fill = NULL  # Remove legend title
)
ggsave("figures/eda2.png", plot = f2, width = 10, height = 6)
tinytex::reinstall_tinytex(repository = "illinois").
tinytex::reinstall_tinytex(repository = "illinois").
tinytex::reinstall_tinytex(repository = "illinois")
tinytex::install_tinytex()
install.packages("tinytex")
install.packages("tinytex")
